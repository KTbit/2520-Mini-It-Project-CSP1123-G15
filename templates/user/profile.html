{% extends "nav_base.html" %}
{% block title %}{{ user.username }}'s Profile{% endblock %}
{% block content %}
<div class="container mt-4">
    <!-- Profile Header -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 text-center">
                    <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center" 
                         style="width: 120px; height: 120px; font-size: 3rem;">
                        {{ user.username[0].upper() }}
                    </div>
                </div>
                <div class="col-md-9">
                    <h2>{{ user.username }}</h2>
                    <p class="text-muted">{{ user.email }}</p>
                    
                    {% if user.is_admin %}
                        <span class="badge bg-danger"><i class="bi bi-shield-lock"></i> Admin</span>
                    {% endif %}
                    
                    <p class="mt-3">
                        <strong>{{ user.posts.count() }}</strong> posts &nbsp;|&nbsp;
                        <strong>{{ user.followers.count() }}</strong> followers &nbsp;|&nbsp;
                        <strong>{{ user.followed.count() }}</strong> following
                    </p>
                    
                    {% if current_user.is_authenticated and current_user.id != user.id %}
                        {% if is_following %}
                            <form method="post" action="{{ url_for('unfollow', user_id=user.id) }}" style="display:inline;">
                                <button type="submit" class="btn btn-secondary">
                                    <i class="bi bi-person-dash"></i> Unfollow
                                </button>
                            </form>
                        {% else %}
                            <form method="post" action="{{ url_for('follow', user_id=user.id) }}" style="display:inline;">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-person-plus"></i> Follow
                                </button>
                            </form>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- User's Posts -->
    <h4><i class="bi bi-file-post"></i> {{ user.username }}'s Posts</h4>
    {% if posts %}
        <div class="row">
            {% for post in posts %}
            <div class="col-md-4 mb-3">
                <div class="card">
                    {% if post.image %}
                        <img src="{{ post.image }}" class="card-img-top" alt="{{ post.title }}">
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ post.title }}</h5>
                        <p class="text-muted small">
                            {{ post.created_at.strftime('%B %d, %Y') if post.created_at else '' }}
                        </p>
                        <a href="{{ url_for('post_view', post_id=post.id) }}" class="btn btn-sm btn-primary">
                            View Post
                        </a>
                        
                        {% if current_user.is_authenticated and (current_user.id == post.user_id or current_user.is_admin) %}
                            <form method="post" action="{{ url_for('delete_post', post_id=post.id) }}" 
                                  style="display:inline;" onsubmit="return confirm('Delete this post?')">
                                <button type="submit" class="btn btn-sm btn-danger">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">{{ user.username }} hasn't posted anything yet.</p>
    {% endif %}
</div>
{% endblock %}


<!--week 5 user profile feature addition-->